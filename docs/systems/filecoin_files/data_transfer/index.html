<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Transfer in Filecoin | Filecoin Spec</title>



<link rel="stylesheet" href="../../../../book.min.cc8a7af7caa5a1f2d6cb09b76c451c38ff26f98a05f07f81e81723e47f8f3ef8.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=EB+Garamond" />


<link rel="icon" href="../../../../favicon.png" type="image/x-icon">


<link rel="alternate" type="application/rss+xml" href="../../../../docs/systems/filecoin_files/data_transfer/index.xml" title="Filecoin Spec" />

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="./gumshoe.polyfills.min.js"></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <link rel="stylesheet" href="../../../../css/syntax.css">
<link href="../../../../mermaid/mermaid.css" type="text/css" rel="stylesheet" />
<script src="../../../../mermaid/mermaid.js"></script>
<script src="../../../../spec.js"></script>

</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href=""><span>Filecoin Spec</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2fsystems\2f filecoin_files\2f data_transfer\2f "] {
      color: #0b3a53;
  }
  </style>


  <div id="menu-toc">

  <div>
    
    <input id="menu-detail-slider" type="range" onchange="onMenuDetailChange();"
      min="1" value="3" max="5" step="1" />

    <span id="menu-detail-slider-label">3</span>
  </div>

  
  
  <ul class="menu-item-section depth-0">
  
      <li>
      
        











<a href="../../../../#intro" class="menu-item depth-1">
    
    
    <strong>
    
        Introduction
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      











<a href="../../../../#intro__arch" class="menu-item depth-2">
    
    
        Architecture Diagrams
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#intro__concepts" class="menu-item depth-2">
    
    
        Key Concepts
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#intro__filecoin_vm" class="menu-item depth-2">
    
    
        Filecoin VM
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__process" class="menu-item depth-2">
    
    
        Process
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#intro__process__about" class="menu-item depth-3">
    
    
        About
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__process__fip" class="menu-item depth-3">
    
    
        FIPs
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__process__contributing" class="menu-item depth-3">
    
    
        Contributing
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#intro__process__related_resources" class="menu-item depth-3">
    
    
        Related Resources
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#intro__process__related_resources__research_portal" class="menu-item depth-4">
    
    
        Research portal
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#intro__process__related_resources__network_tooling" class="menu-item depth-4">
    
    
        Network tooling
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#intro__process__related_resources__testing" class="menu-item depth-4">
    
    
        Testing and implementation compliance
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__changelog" class="menu-item depth-2">
    
    
        Change Log
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__system" class="menu-item depth-2">
    
    
        System Decomposition
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#intro__system__why_systems" class="menu-item depth-3">
    
    
        What are Systems?
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#intro__system__impl_systems" class="menu-item depth-3">
    
    
        Implementing Systems
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


      
      </li>
  
      <li>
      
        











<a href="../../../../#systems" class="menu-item depth-1">
    
    
    <strong>
    
        Systems
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes" class="menu-item depth-2">
    ‚öôÔ∏è
    
        <strong>Filecoin Nodes</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types" class="menu-item depth-3">
    
    
        Node Types
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__node" class="menu-item depth-4">
    
    
        Node Interface
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__node_types" class="menu-item depth-4">
    
    
        Examples
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__verifier_node" class="menu-item depth-4">
    
    
        Chain Verifier Node
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__client_node" class="menu-item depth-4">
    
    
        Client Node
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__storage_miner_node" class="menu-item depth-4">
    
    
        Storage Miner Node
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__retrieval_miner_node" class="menu-item depth-4">
    
    
        Retrieval Miner Node
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__node_types__relayer_node" class="menu-item depth-4">
    
    
        Relayer Node
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_nodes__repository" class="menu-item depth-3">
    
    
        Repository
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_nodes__repository__config" class="menu-item depth-4">
    
    
        Config
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__repository__key_store" class="menu-item depth-4">
    
    
        Key Store
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_nodes__repository__ipldstore" class="menu-item depth-4">
    
    
        IpldStore
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__network" class="menu-item depth-3">
    
    
        Network Interface
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_nodes__clock" class="menu-item depth-3">
    
    
        Clock
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files" class="menu-item depth-2">
    üìë
    
        <strong>Files &amp; Data</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#systems__filecoin_files__file" class="menu-item depth-3">
    
    
        File
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files__file__filestore" class="menu-item depth-4">
    
    
        FileStore
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files__piece" class="menu-item depth-3">
    
    
        Piece
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files__piece__piece_store" class="menu-item depth-4">
    
    
        PieceStore
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files__data_transfer" class="menu-item depth-3">
    
    
        Data Transfer
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_files__serialization" class="menu-item depth-3">
    
    
        Formats and Serialization
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm" class="menu-item depth-2">
    üíª
    
        <strong>Virtual Machine</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__actor" class="menu-item depth-3">
    
    
        Actor
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__state_tree" class="menu-item depth-3">
    
    
        State Tree
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__indices" class="menu-item depth-3">
    
    
        Indices
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__message" class="menu-item depth-3">
    
    
        Message
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__runtime" class="menu-item depth-3">
    
    
        Runtime
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__runtime__gascost" class="menu-item depth-4">
    
    
        Gas Costs
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__sysactors" class="menu-item depth-3">
    
    
        System Actors
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__sysactors__init_actor" class="menu-item depth-4">
    
    
        InitActor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__sysactors__cron_actor" class="menu-item depth-4">
    
    
        CronActor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__sysactors__account_actor" class="menu-item depth-4">
    
    
        AccountActor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_vm__sysactors__reward_actor" class="menu-item depth-4">
    
    
        RewardActor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_vm__interpreter" class="menu-item depth-3">
    
    
        Interpreter
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain" class="menu-item depth-2">
    üì¶
    
        <strong>Blockchain</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct" class="menu-item depth-3">
    
    
        Blocks
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct__block" class="menu-item depth-4">
    
    
        Block
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct__tipset" class="menu-item depth-4">
    
    
        Tipset
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct__chain" class="menu-item depth-4">
    
    
        Chain
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct__chain_manager" class="menu-item depth-4">
    
    
        Chain Manager
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__struct__block_producer" class="menu-item depth-4">
    
    
        Block Producer
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__message_pool" class="menu-item depth-3">
    
    
        Message Pool
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__message_pool__message_syncer" class="menu-item depth-4">
    
    
        Message Syncer
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__message_pool__message_storage" class="menu-item depth-4">
    
    
        Message Storage
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_blockchain__chainsync" class="menu-item depth-3">
    
    
        ChainSync
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__storage_power_consensus" class="menu-item depth-3">
    
    
        Storage Power Consensus
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_blockchain__storage_power_consensus__storage_power_actor" class="menu-item depth-4">
    
    
        Storage Power Actor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_token" class="menu-item depth-2">
    üìÄ
    
        <strong>Token</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_token__wallets" class="menu-item depth-3">
    
    
        Wallet
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_token__payment_channels" class="menu-item depth-3">
    
    
        Payment Channels
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_token__payment_channels__payment_channel_actor" class="menu-item depth-4">
    
    
        Payment Channel Actor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_token__multisig" class="menu-item depth-3">
    
    
        Multisig Wallet
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_token__multisig__multisig_actor" class="menu-item depth-4">
    
    
        Multisig Actor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_mining" class="menu-item depth-2">
    ‚õè
    
        <strong>Storage Mining</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_mining__storage_mining" class="menu-item depth-3">
    
    
        Storage Miner
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__storage_mining__mining_cycle" class="menu-item depth-4">
    
    
        Storage Mining Cycle
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__storage_mining__storage_miner_actor" class="menu-item depth-4">
    
    
        Storage Miner Actor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector" class="menu-item depth-3">
    
    
        Sector
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector__sectorset" class="menu-item depth-4">
    
    
        Sector Set
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector__posting" class="menu-item depth-4">
    
    
        Sector PoSting
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector__sealing" class="menu-item depth-4">
    
    
        Sector Sealing
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector_index" class="menu-item depth-3">
    
    
        Sector Index
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
    </li>

    <li>
    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector_index__sector_builder" class="menu-item depth-4">
    
    
        Sector Builder
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__sector_index__sector_store" class="menu-item depth-4">
    
    
        SectorStore
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_mining__storage_proving" class="menu-item depth-3">
    
    
        Storage Proving
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_mining__storage_proving__sealer" class="menu-item depth-4">
    
    
        Sector Sealer
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_mining__storage_proving__poster" class="menu-item depth-4">
    
    
        Sector Poster
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets" class="menu-item depth-2">
    ‚öñÔ∏è
    
        <strong>Market</strong>
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets__storage_market" class="menu-item depth-3">
    
    
        Storage Market
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets__storage_market__storage_deal" class="menu-item depth-4">
    
    
        Storage Deal
    
</a>



<ul class="menu-item-section depth-4">

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets__storage_market__storage_deal__storage_deal_flow" class="menu-item depth-5">
    
    
        Deal Flow
    
</a>



<ul class="menu-item-section depth-5">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets__storage_market__storage_deal__storage_deal_states" class="menu-item depth-5">
    
    
        Deal States
    
</a>



<ul class="menu-item-section depth-5">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__storage_market__storage_deal__faults" class="menu-item depth-5">
    
    
        Faults
    
</a>



<ul class="menu-item-section depth-5">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__storage_market__storage_market_actor" class="menu-item depth-4">
    
    
        Storage Market Actor
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__storage_market__storage_provider" class="menu-item depth-4">
    
    
        Storage Provider
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__storage_market__storage_client" class="menu-item depth-4">
    
    
        Storage Client
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#systems__filecoin_markets__retrieval_market" class="menu-item depth-3">
    
    
        Retrieval Market
    
</a>



<ul class="menu-item-section depth-3">

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__retrieval_market__retrieval_peer_resolver" class="menu-item depth-4">
    
    
        Retrieval Peer Resolver
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__retrieval_market__retrieval_protocols" class="menu-item depth-4">
    
    
        Retrieval Protocols
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__retrieval_market__retrieval_client" class="menu-item depth-4">
    
    
        Retrieval Client
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#systems__filecoin_markets__retrieval_market__retrieval_provider" class="menu-item depth-4">
    
    
        Retrieval Provider (Miner)
    
</a>



<ul class="menu-item-section depth-4">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


      
      </li>
  
      <li>
      
        










  


<a href="../../../../#libraries" class="menu-item depth-1">
    
    
    <strong>
    
        Libraries
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      










  


<a href="../../../../#libraries__filcrypto" class="menu-item depth-2">
    
    
        Filcrypto
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#libraries__filcrypto__filproofs" class="menu-item depth-3">
    
    
        filproofs
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#libraries__fcs" class="menu-item depth-2">
    
    
        FCS
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__ipld" class="menu-item depth-2">
    
    
        IPLD
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#libraries__ipld__cid" class="menu-item depth-3">
    
    
        CID
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#libraries__ipld__datamodel" class="menu-item depth-3">
    
    
        Data Model
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__ipld__selectors" class="menu-item depth-3">
    
    
        Selectors
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__libp2p" class="menu-item depth-2">
    
    
        libp2p
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      










  


<a href="../../../../#libraries__libp2p__gossipsub" class="menu-item depth-3">
    
    
        gossipsub
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__libp2p__kad_dht" class="menu-item depth-3">
    
    
        kad-dht
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__libp2p__fil_libp2p_nodes" class="menu-item depth-3">
    
    
        fil-libp2p Nodes
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__ipfs" class="menu-item depth-2">
    
    
        IPFS
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#libraries__ipfs__bitswap" class="menu-item depth-3">
    
    
        BitSwap
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#libraries__ipfs__graphsync" class="menu-item depth-3">
    
    
        GraphSync
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#libraries__ipfs__unixfs" class="menu-item depth-3">
    
    
        UnixFS
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      










  


<a href="../../../../#libraries__multiformats" class="menu-item depth-2">
    
    
        Multiformats
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

</ul>


      
      </li>
  
      <li>
      
        











<a href="../../../../#algorithms" class="menu-item depth-1">
    
    
    <strong>
    
        Algorithms
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      











<a href="../../../../#algorithms__expected_consensus" class="menu-item depth-2">
    
    
        Expected Consensus
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__porep" class="menu-item depth-2">
    
    
        Proof-of-Replication
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#algorithms__porep__stacked_drg" class="menu-item depth-3">
    
    
        Stacked DRG PoRep
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__porep__porep_commitments" class="menu-item depth-3">
    
    
        PoRep Commitments
    
</a>




    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__porep__stacked_drg_circuit" class="menu-item depth-3">
    
    
        Stacked DRG - Offline PoRep Circuit Spec
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__post" class="menu-item depth-2">
    
    
        Proof-of-Spacetime
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#algorithms__post__election_post" class="menu-item depth-3">
    
    
        Election PoSt
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__post__proof_of_spacetime_parameters" class="menu-item depth-3">
    
    
        PoSt Parameters
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__payment_channels" class="menu-item depth-2">
    
    
        Payment Channels
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__block_sync" class="menu-item depth-2">
    
    
        BlockSync
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__gossip_sub" class="menu-item depth-2">
    
    
        GossipSub
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#algorithms__crypto" class="menu-item depth-2">
    
    
        Cryptographic Primitives
    
</a>




    
    </li>

    <li>
    
      










  


<a href="../../../../#algorithms__cryptoecon" class="menu-item depth-2">
    
    
        Cryptoecon
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

</ul>


      
      </li>
  
      <li>
      
        











<a href="../../../../#listings" class="menu-item depth-1">
    
    
    <strong>
    
        Listings
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      











<a href="../../../../#listings__actors" class="menu-item depth-2">
    
    
        Filecoin VM Actors
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#listings__reserved_ranges" class="menu-item depth-2">
    
    
        Reserved Ranges
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#listings__data_structures" class="menu-item depth-2">
    
    
        Data Structures
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#listings__system_map" class="menu-item depth-2">
    
    
        Components
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#listings__libp2p_protocols" class="menu-item depth-2">
    
    
        libp2p Protocols
    
</a>



<ul class="menu-item-section depth-2">

    <li>
    
      











<a href="../../../../#listings__libp2p_protocols__data_transfer_protocol" class="menu-item depth-3">
    
    
        Data Transfer Protocol
    
</a>



<ul class="menu-item-section depth-3">

</ul>


    
    </li>

</ul>


    
    </li>

</ul>


      
      </li>
  
      <li>
      
        











<a href="../../../../#glossary" class="menu-item depth-1">
    
    
    <strong>
    
        Glossary
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

</ul>


      
      </li>
  
      <li>
      
        











<a href="../../../../#appendix" class="menu-item depth-1">
    
    
    <strong>
    
        Appendix
    
    </strong>
    
</a>



<ul class="menu-item-section depth-1">

    <li>
    
      











<a href="../../../../#appendix__sharray" class="menu-item depth-2">
    
    
        Sharded IPLD Array
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#appendix__address" class="menu-item depth-2">
    
    
        Address
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

    <li>
    
      











<a href="../../../../#appendix__network_params" class="menu-item depth-2">
    
    
        Filecoin Parameters
    
</a>



<ul class="menu-item-section depth-2">

</ul>


    
    </li>

</ul>


      
      </li>
  
  </ul>
  
</div>










</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="../../../../svg/menu.svg" alt="Menu" />
  </label>
  <strong>Data Transfer in Filecoin</strong>
</header>

      
<article class="markdown"><p><em>Data Transfer</em> is a system for transferring all or part of a <code>Piece</code> across the network when a deal is made.</p>
<h1 id="modules">Modules</h1>
<p>This diagram shows how Data Transfer and its modules fit into the picture with the Storage and Retrieval Markets.
In particular, note how the Data Transfer Request Validators from the markets are plugged into the Data Transfer module,
but their code belongs in the Markets system.</p>












<div class="diagram">

<span class="diagram-title">Data Transfer - Push Flow</span>




(<a href="docs/systems/filecoin_files/data_transfer/data-transfer-modules.png" target="_blank">open in new tab</a>)
<br />
<img src="docs/systems/filecoin_files/data_transfer/data-transfer-modules.png" />




</div>

<h1 id="terminology">Terminology</h1>
<ul>
<li><strong>Push Request</strong>: A request to send data to the other party</li>
<li><strong>Pull Request</strong>: A request to have the other party send data</li>
<li><strong>Requestor</strong>: The party that initiates the data transfer request (whether Push or Pull)</li>
<li><strong>Responder</strong>: The party that receives the data transfer request</li>
<li><strong>Data Transfer Voucher</strong>: A wrapper around storage or retrieval data that can identify and validate the transfer request to the other party</li>
<li><strong>Request Validator</strong>: The data transfer module only initiates a transfer when the responder can validate that the request is tied directly to either an existing storage deal or retrieval deal. Validation is not performed by the data transfer module itself. Instead, a request validator inspects the data transfer voucher to determine whether to respond to the request.</li>
<li><strong>Scheduler</strong>:  Once a request is negotiated and validated, actual transfer is managed by a scheduler on both sides. The scheduler is part of the data transfer module but is isolated from the negotiation process. It has access to an underlying verifiable transport protocol and uses it to send data and track progress.</li>
<li><strong>Subscriber</strong>: An external component that monitors progress of a data transfer by subscribing to data transfer events, such as progress or completion.</li>
<li><strong>GraphSync</strong>: The default underlying transfer protocol used by the Scheduler. The full graphsync specification can be found at <a href="https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md">https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md</a></li>
</ul>
<h1 id="request-phases">Request Phases</h1>
<p>There are two basic phases to any data transfer:</p>
<ol>
<li>Negotiation - the requestor and responder agree to the transfer by validating with the data transfer voucher</li>
<li>Transfer - Once the negotiation phase is complete, the data is actually transferred. The default protocol used to do the transfer is Graphsync.</li>
</ol>
<p>Note that the Negotiation and Transfer stages can occur in separate round trips,
or potentially the same round trip, where the requesting party implicitly agrees by sending the request, and the responding party can agree and immediately send or receive data.</p>
<h1 id="example-flows">Example Flows</h1>
<h2 id="push-flow">Push Flow</h2>












<div class="diagram">

<span class="diagram-title">Data Transfer - Push Flow</span>




(<a href="docs/systems/filecoin_files/data_transfer/push-flow.mmd.svg" target="_blank">open in new tab</a>)
<br />
<img src="docs/systems/filecoin_files/data_transfer/push-flow.mmd.svg" />




</div>

<ol>
<li>A requestor initiates a Push transfer when it wants to send data to another party.</li>
<li>The requestors&rsquo; data transfer module will send a push request to the responder along with the data transfer voucher. It also puts the data transfer in the scheduler queue, meaning it expects the responder to initiate a transfer once the request is verified</li>
<li>The responder&rsquo;s data transfer module validates the data transfer request via the Validator provided as a dependency by the responder</li>
<li>The responder&rsquo;s data transfer module schedules the transfer</li>
<li>The responder makes a GraphSync request for the data</li>
<li>The requestor receives the graphsync request, verifies it&rsquo;s in the scheduler and begins sending data</li>
<li>The responder receives data and can produce an indication of progress</li>
<li>The responder completes receiving data, and notifies any listeners</li>
</ol>
<p>The push flow is ideal for storage deals, where the client initiates the push
once it verifies the the deal is signed and on chain</p>
<h2 id="pull-flow">Pull Flow</h2>












<div class="diagram">

<span class="diagram-title">Data Transfer - Pull Flow</span>




(<a href="docs/systems/filecoin_files/data_transfer/pull-flow.mmd.svg" target="_blank">open in new tab</a>)
<br />
<img src="docs/systems/filecoin_files/data_transfer/pull-flow.mmd.svg" />




</div>

<ol>
<li>A requestor initiates a Pull transfer when it wants to receive data from another party.</li>
<li>The requestors&rsquo; data transfer module will send a pull request to the responder along with the data transfer voucher.</li>
<li>The responder&rsquo;s data transfer module validates the data transfer request via a PullValidator provided as a dependency by the responder</li>
<li>The responder&rsquo;s data transfer module schedules the transfer (meaning it is expecting the requestor to initiate the actual transfer)</li>
<li>The responder&rsquo;s data transfer module sends a response to the requestor saying it has accepted the transfer and is waiting for the requestor to initiate the transfer</li>
<li>The requestor schedules the data transfer</li>
<li>The requestor makes a GraphSync request for the data</li>
<li>The responder receives the graphsync request, verifies it&rsquo;s in the scheduler and begins sending data</li>
<li>The requestor receives data and can produce an indication of progress</li>
<li>The requestor completes receiving data, and notifies any listeners</li>
</ol>
<p>The pull flow is ideal for retrieval deals, where the client initiates the pull when the deal is agreed upon.</p>
<h1 id="alternater-pull-flow---single-round-trip">Alternater Pull Flow - Single Round Trip</h1>












<div class="diagram">

<span class="diagram-title">Data Transfer - Single Round Trip Pull Flow</span>




(<a href="docs/systems/filecoin_files/data_transfer/alternate-pull-flow.mmd.svg" target="_blank">open in new tab</a>)
<br />
<img src="docs/systems/filecoin_files/data_transfer/alternate-pull-flow.mmd.svg" />




</div>

<ol>
<li>A requestor initiates a Pull transfer when it wants to receive data from another party.</li>
<li>The requestor‚Äôs DTM schedules the data transfer</li>
<li>The requestor makes a Graphsync request to the responder with a data transfer request</li>
<li>The responder receives the graphsync request, and forwards the data transfer request to the data transfer module</li>
<li>The requestors&rsquo; data transfer module will send a pull request to the responder along with the data transfer voucher.</li>
<li>The responder&rsquo;s data transfer module validates the data transfer request via a PullValidator provided as a dependency by the responder</li>
<li>The responder&rsquo;s data transfer module schedules the transfer</li>
<li>The responder sends a graphsync response along with a data transfer accepted response piggypacked</li>
<li>The requestor receives data and can produce an indication of progress</li>
<li>The requestor completes receiving data, and notifies any listeners</li>
</ol>
<h1 id="protocol">Protocol</h1>
<p>A data transfer CAN be negotiated over the network via the <a href="../../../../#listings__libp2p_protocols__data_transfer_protocol">Data Transfer Protocol</a>, a Libp2p protocol type</p>
<p>A Pull request expects a response. The requestor does not initiate the transfer
until they know the request is accepted.</p>
<p>The responder should send a response to a push request as well so the requestor can release the resources (if not accepted). However, if the Responder accepts the request they can immediately initiate the transfer</p>
<p>Using the Data Transfer Protocol as an independent libp2p communciation mechanism is not a hard requirement &ndash; as long as both parties have an implementation of the Data Transfer Subsystem that can talk to the other, any
transport mechanism (including offline mechanisms) is acceptable.</p>
<h1 id="data-structures">Data Structures</h1>



















<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="nx">ipld</span> <span class="s">&#34;github.com/filecoin-project/specs/libraries/ipld&#34;</span>
<span class="kn">import</span> <span class="nx">libp2p</span> <span class="s">&#34;github.com/filecoin-project/specs/libraries/libp2p&#34;</span>
<span class="kn">import</span> <span class="nx">cid</span> <span class="s">&#34;github.com/ipfs/go-cid&#34;</span>
<span class="kn">import</span> <span class="nx">piece</span> <span class="s">&#34;github.com/filecoin-project/specs/systems/filecoin_files/piece&#34;</span>
<span class="kn">import</span> <span class="nx">peer</span> <span class="s">&#34;github.com/libp2p/go-libp2p-core/peer&#34;</span>

<span class="kd">type</span> <span class="nx">StorageDeal</span> <span class="kd">struct</span> <span class="p">{}</span>
<span class="kd">type</span> <span class="nx">RetrievalDeal</span> <span class="kd">struct</span> <span class="p">{}</span>

<span class="c1">// A DataTransferVoucher is used to validate
</span><span class="c1">// a data transfer request against the underlying storage or retrieval deal
</span><span class="c1">// that precipitated it
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">DataTransferVoucher</span> <span class="nx">union</span> <span class="p">{</span>
    <span class="nx">StorageDealVoucher</span>
    <span class="nx">RetrievalDealVoucher</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">StorageDealVoucher</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">deal</span> <span class="nx">StorageDeal</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">RetrievalDealVoucher</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">deal</span> <span class="nx">RetrievalDeal</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Ongoing</span> <span class="kd">struct</span> <span class="p">{}</span>
<span class="kd">type</span> <span class="nx">Paused</span> <span class="kd">struct</span> <span class="p">{}</span>
<span class="kd">type</span> <span class="nx">Completed</span> <span class="kd">struct</span> <span class="p">{}</span>
<span class="kd">type</span> <span class="nx">Failed</span> <span class="kd">struct</span> <span class="p">{}</span>
<span class="kd">type</span> <span class="nx">ChannelNotFoundError</span> <span class="kd">struct</span> <span class="p">{}</span>

<span class="kd">type</span> <span class="nx">DataTransferStatus</span> <span class="nx">union</span> <span class="p">{</span>
    <span class="nx">Ongoing</span>
    <span class="nx">Paused</span>
    <span class="nx">Completed</span>
    <span class="nx">Failed</span>
    <span class="nx">ChannelNotFoundError</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">TransferID</span> <span class="nx">UInt</span>

<span class="kd">type</span> <span class="nx">ChannelID</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">to</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
    <span class="nx">id</span> <span class="nx">TransferID</span>
<span class="p">}</span>

<span class="c1">// All immutable data for a channel
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">DataTransferChannel</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// an identifier for this channel shared by request and responder, set by requestor through protocol
</span><span class="c1"></span>    <span class="nx">transferID</span>  <span class="nx">TransferID</span>
    <span class="c1">// base CID for the piece being transferred
</span><span class="c1"></span>    <span class="nx">PieceRef</span>    <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
    <span class="c1">// portion of Piece to return, specified by an IPLD selector
</span><span class="c1"></span>    <span class="nx">Selector</span>    <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="c1">// used to verify this channel
</span><span class="c1"></span>    <span class="nx">voucher</span>     <span class="nx">DataTransferVoucher</span>
    <span class="c1">// the party that is sending the data (not who initiated the request)
</span><span class="c1"></span>    <span class="nx">sender</span>      <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
    <span class="c1">// the party that is receiving the data (not who initiated the request)
</span><span class="c1"></span>    <span class="nx">recipient</span>   <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
    <span class="c1">// expected amount of data to be transferred
</span><span class="c1"></span>    <span class="nx">totalSize</span>   <span class="nx">UVarint</span>
<span class="p">}</span>

<span class="c1">// DataTransferState is immutable channel data plus mutable state
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">DataTransferState</span> <span class="kd">struct</span> <span class="err">@</span><span class="p">(</span><span class="nx">mutable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">DataTransferChannel</span>
    <span class="c1">// total bytes sent from this node (0 if receiver)
</span><span class="c1"></span>    <span class="nx">sent</span>                 <span class="nx">UVarint</span>
    <span class="c1">// total bytes received by this node (0 if sender)
</span><span class="c1"></span>    <span class="nx">received</span>             <span class="nx">UVarint</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Open</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Initiator</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">SendData</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">BytesToSend</span> <span class="nx">UInt</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Progress</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">BytesSent</span> <span class="nx">UInt</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Pause</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Initiator</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Error</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">ErrorMsg</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Complete</span> <span class="kd">struct</span> <span class="p">{}</span>

<span class="kd">type</span> <span class="nx">DataTransferEvent</span> <span class="nx">union</span> <span class="p">{</span>
    <span class="nx">Open</span>
    <span class="nx">SendData</span>
    <span class="nx">Progress</span>
    <span class="nx">Pause</span>
    <span class="nx">Error</span>
    <span class="nx">Complete</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">DataTransferSubscriber</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nf">OnEvent</span><span class="p">(</span><span class="nx">event</span> <span class="nx">DataTransferEvent</span><span class="p">,</span> <span class="nx">channelState</span> <span class="nx">DataTransferState</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// RequestValidator is an interface implemented by the client of the data transfer module to validate requests
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">RequestValidator</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nf">ValidatePush</span><span class="p">(</span>
        <span class="nx">sender</span>    <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
        <span class="nx">voucher</span>   <span class="nx">DataTransferVoucher</span>
        <span class="nx">PieceRef</span>  <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
        <span class="nx">Selector</span>  <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="p">)</span>
    <span class="nf">ValidatePull</span><span class="p">(</span>
        <span class="nx">receiver</span>  <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
        <span class="nx">voucher</span>   <span class="nx">DataTransferVoucher</span>
        <span class="nx">PieceRef</span>  <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
        <span class="nx">Selector</span>  <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="p">)</span>
    <span class="nf">ValidateIntermediate</span><span class="p">(</span>
        <span class="nx">otherPeer</span>  <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
        <span class="nx">voucher</span>    <span class="nx">DataTransferVoucher</span>
        <span class="nx">PieceRef</span>   <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
        <span class="nx">Selector</span>   <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">DataTransferSubsystem</span> <span class="kd">struct</span> <span class="err">@</span><span class="p">(</span><span class="nx">mutable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">host</span>              <span class="nx">libp2p</span><span class="p">.</span><span class="nx">Node</span>
    <span class="nx">dataTransfers</span>     <span class="p">{</span><span class="nx">ChannelID</span><span class="p">:</span> <span class="nx">DataTransferState</span><span class="p">}</span>
    <span class="nx">requestValidator</span>  <span class="nx">RequestValidator</span>
    <span class="nx">pieceStore</span>        <span class="nx">piece</span><span class="p">.</span><span class="nx">PieceStore</span>

    <span class="c1">// open a data transfer that will send data to the recipient peer and
</span><span class="c1"></span>    <span class="c1">// open a data transfer that will send data to the recipient peer and
</span><span class="c1"></span>    <span class="c1">// transfer parts of the piece that match the selector
</span><span class="c1"></span>    <span class="nf">OpenPushDataChannel</span><span class="p">(</span>
        <span class="nx">to</span>        <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
        <span class="nx">voucher</span>   <span class="nx">DataTransferVoucher</span>
        <span class="nx">PieceRef</span>  <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
        <span class="nx">Selector</span>  <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="p">)</span> <span class="nx">ChannelID</span>

    <span class="c1">// open a data transfer that will request data from the sending peer and
</span><span class="c1"></span>    <span class="c1">// transfer parts of the piece that match the selector
</span><span class="c1"></span>    <span class="nf">OpenPullDataChannel</span><span class="p">(</span>
        <span class="nx">to</span>        <span class="nx">peer</span><span class="p">.</span><span class="nx">ID</span>
        <span class="nx">voucher</span>   <span class="nx">DataTransferVoucher</span>
        <span class="nx">PieceRef</span>  <span class="nx">cid</span><span class="p">.</span><span class="nx">Cid</span>
        <span class="nx">Selector</span>  <span class="nx">ipld</span><span class="p">.</span><span class="nx">Selector</span>
    <span class="p">)</span> <span class="nx">ChannelID</span>

    <span class="c1">// close an open channel (effectively a cancel)
</span><span class="c1"></span>    <span class="nf">CloseDataTransferChannel</span><span class="p">(</span><span class="nx">x</span> <span class="nx">ChannelID</span><span class="p">)</span>

    <span class="c1">// get status of a transfer
</span><span class="c1"></span>    <span class="nf">TransferChannelStatus</span><span class="p">(</span><span class="nx">x</span> <span class="nx">ChannelID</span><span class="p">)</span> <span class="nx">DataTransferStatus</span>

    <span class="c1">// pause an ongoing channel
</span><span class="c1"></span>    <span class="nf">PauseChannel</span><span class="p">(</span><span class="nx">x</span> <span class="nx">ChannelID</span><span class="p">)</span>

    <span class="c1">// resume an ongoing channel
</span><span class="c1"></span>    <span class="nf">ResumeChannel</span><span class="p">(</span><span class="nx">x</span> <span class="nx">ChannelID</span><span class="p">)</span>

    <span class="c1">// send an additional voucher for an in progress request
</span><span class="c1"></span>    <span class="nf">SendIntermediateVoucher</span><span class="p">(</span><span class="nx">x</span> <span class="nx">ChannelID</span><span class="p">,</span> <span class="nx">voucher</span> <span class="nx">DataTransferVoucher</span><span class="p">)</span>

    <span class="c1">// get notified when certain types of events happen
</span><span class="c1"></span>    <span class="nf">SubscribeToEvents</span><span class="p">(</span><span class="nx">subscriber</span> <span class="nx">DataTransferSubscriber</span><span class="p">)</span>

    <span class="c1">// get all in progress transfers
</span><span class="c1"></span>    <span class="nf">InProgressChannels</span><span class="p">()</span> <span class="p">{</span><span class="nx">ChannelID</span><span class="p">:</span> <span class="nx">DataTransferState</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>





</article>

      

      
    </div>

    
  

  <aside class="book-toc level-6 fixed">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#push-flow">Push Flow</a></li>
    <li><a href="#pull-flow">Pull Flow</a></li>
  </ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
